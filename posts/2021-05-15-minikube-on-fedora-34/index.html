<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><title>minikube on Fedora 34 with podman - hallajs.net</title><meta name=description content="A while ago, I had encountered issues while trying to run minikube on Fedora 33 with podman. Strangely enough I did not keep notes on what I did to get it to work and when I did a fresh installation on Fedora 34, the old error haunted me back again.
Leaning from the past mistake, I suppose it&rsquo;s time to start taking notes on what&rsquo;s the error encountered and what did I do to fix it."><meta name=author content="Muhammad Hallaj"><link href=http://ghpages-stage.hallajs.net/an-old-hope.min.css rel=stylesheet><link href=http://ghpages-stage.hallajs.net/style.css rel=stylesheet><link href=http://ghpages-stage.hallajs.net/custom.css rel=stylesheet><link rel=apple-touch-icon href=http://ghpages-stage.hallajs.net/apple-touch-icon.png><link rel=icon href=http://ghpages-stage.hallajs.net/favicon.ico><meta name=generator content="Hugo 0.84.4"><script>function setTheme(){if(window.matchMedia('(prefers-color-scheme: dark)').matches){document.body.classList.add('dark');return}const c=new Date,g=localStorage.getItem('date'),d=String(c.getMonth()+1)+'.'+String(c.getDate()),e=c.getTime();let a,b;function f(){if(e>a&&e<b)return;document.body.classList.add('dark')}d!==g?(fetch('https://api.ipgeolocation.io/astronomy?apiKey=5ed37d85103e4defa5df4c5298ed5215').then(a=>a.json()).then(c=>{a=c.sunrise.split(':').map(Number),b=c.sunset.split(':').map(Number)}).catch(()=>{a=[7,0],b=[19,0]}).finally(()=>{a=c.setHours(a[0],a[1],0),b=c.setHours(b[0],b[1],0),f(),localStorage.setItem('sunrise',a),localStorage.setItem('sunset',b)}),localStorage.setItem('date',d)):(a=Number(localStorage.getItem('sunrise')),b=Number(localStorage.getItem('sunset')),f())}</script></head><body class=single><script>setTheme()</script><header class=header><nav class=nav><p class=logo><a href=http://ghpages-stage.hallajs.net>hallajs.net</a></p></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>minikube on Fedora 34 with podman</h1><div class=post-meta>Muhammad Hallaj ¬∑ May 15, 2021</div></header><div class=post-content><p>A while ago, I had encountered issues while trying to run <a href=https://minikube.sigs.k8s.io/docs/>minikube</a> on <a href=https://getfedora.org/>Fedora 33</a> with <a href=https://podman.io/>podman</a>. Strangely enough I did not keep notes on what I did to get it to work and when I did a fresh installation on <a href=https://getfedora.org/>Fedora 34</a>, the old error haunted me back again.</p><p>Leaning from the past mistake, I suppose it&rsquo;s time to start taking notes on what&rsquo;s the error encountered and what did I do to fix it.</p><p>Below are the steps I&rsquo;ve taken to get it installed.</p><ol><li>Step 1; Follow the installation guide of minikube from their <a href=https://minikube.sigs.k8s.io/docs/start/>Get started!</a> page.</li><li>Step 2; Ensure podman&rsquo;s installed on our Fedora 34<pre><code>$ sudo dnf -y install podman
</code></pre></li><li>Step 3; Since <a href=https://minikube.sigs.k8s.io/docs/>minikube</a> uses <code>podman</code> with passwordless <code>sudo</code>, we&rsquo;ll need to ensure our user has the permission to run <code>podman</code> without sudo<code>sudo</code>. The way I do it is to create a new <code>podman</code> group and have my user added to it.<pre><code>$ sudo groupadd podman
$ sudo gpasswd -a $USER podman
$ newgrp podman  # use this if you're lazy to re-login to enable your new group
$ sudo cat &lt;&lt;eof &gt;/etc/sudoers.d/podman
%podman ALL=(ALL) NOPASSWD: /usr/bin/podman
eof
</code></pre></li><li>Step 4; By using the guide from <a href=https://minikube.sigs.k8s.io/docs/drivers/podman/>minikube&rsquo;s podman driver</a>, the recommended way to start <code>minikube</code> is to execute <code>minikube start --driver=podman --container-runtime=cri-o</code>. Unfortunately for me, if I use just that perimeter, somehow the cluster would not launch.<pre><code>$ minikube start --driver=podman --container-runtime=cri-o
üòÑ  minikube v1.20.0 on Fedora 34
‚ú®  Using the podman driver based on user configuration
..
..
stderr:
        [WARNING Swap]: running with swap on is not supported. Please disable swap
        [WARNING Service-Kubelet]: kubelet service is not enabled, please run 'systemctl enable kubelet.service'
error execution phase wait-control-plane: couldn't initialize a Kubernetes cluster
To see the stack trace of this error execute with --v=5 or higher

üí°  Suggestion: Check output of 'journalctl -xeu kubelet', try passing --extra-config=kubelet.cgroup-driver=systemd to minikube start
üçø  Related issue: https://github.com/kubernetes/minikube/issues/4172
</code></pre><p>After some digging, it would appear that because we&rsquo;re running <code>btrfs</code>, the mapper device was carried over into podman but couldn&rsquo;t be located. Thankfully, <code>minikube</code> has something to counter that - <code>"LocalStorageCapacityIsolation=false"</code>, so if we use the following, we should be able to deploy a minikube cluster without issues</p><pre><code>$ minikube start --driver=podman --container-runtime=cri-o --feature-gates=&quot;LocalStorageCapacityIsolation=false&quot;
üòÑ  minikube v1.20.0 on Fedora 34
..
..
üåü  Enabled addons: storage-provisioner, default-storageclass
üèÑ  Done! kubectl is now configured to use &quot;minikube&quot; cluster and &quot;default&quot; namespace by default
</code></pre><p>You could even confirm by running <code>kubectl get pods -A</code> to confirm it&rsquo;s running</p><pre><code>$ kubectl get pods -A
NAMESPACE     NAME                               READY   STATUS    RESTARTS   AGE
kube-system   coredns-74ff55c5b-hjfct            1/1     Running   0          40s
kube-system   etcd-minikube                      0/1     Running   0          50s
kube-system   kindnet-9g6bn                      1/1     Running   0          40s
kube-system   kube-apiserver-minikube            1/1     Running   0          50s
kube-system   kube-controller-manager-minikube   0/1     Running   0          50s
kube-system   kube-proxy-fkmjz                   1/1     Running   0          40s
kube-system   kube-scheduler-minikube            0/1     Running   0          50s
kube-system   storage-provisioner                1/1     Running   0          55s
</code></pre></li></ol></div><footer class=post-footer><ul class=post-tags><li><a href=http://ghpages-stage.hallajs.net/tags/fedora>fedora</a></li><li><a href=http://ghpages-stage.hallajs.net/tags/minikube>minikube</a></li><li><a href=http://ghpages-stage.hallajs.net/tags/podman>podman</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2021 <a href=http://ghpages-stage.hallajs.net>hallajs.net</a></span>
<span>&#183;</span>
<span>Powered by <a href=https://gohugo.io/ rel=noopener target=_blank>HugoÔ∏èÔ∏è</a>Ô∏è</span>
<span>&#183;</span>
<span>ThemeÔ∏è <a href=https://github.com/nanxiaobei/hugo-paper rel=noopener target=_blank>Paper</a></span></footer><script src=http://ghpages-stage.hallajs.net/highlight.min.js></script><script>hljs.initHighlightingOnLoad()</script></body></html>